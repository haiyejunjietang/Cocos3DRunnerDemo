{"version":3,"sources":["file:///D:/tangjianhua/cocos%20games/JareAdventure_/assets/scripts/HUD_Distance.ts"],"names":["_decorator","Component","Label","Node","Player","ccclass","property","Distance","content","maxDistanceNum","start","node","getComponent","savedMax","localStorage","getItem","parseFloat","MaxDistance","string","toFixed","update","deltaTime","player","enabled","z","position","normalizedZ","Math","abs","setItem","toString"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;;AAC9BC,MAAAA,M,iBAAAA,M;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;0BAGjBO,Q,WADZF,OAAO,CAAC,UAAD,C,UAGHC,QAAQ,CAACH,IAAD,C,UAERG,QAAQ,CAACJ,KAAD,C,UAERI,QAAQ,CAACJ,KAAD,C,2BAPb,MACaK,QADb,SAC8BN,SAD9B,CACwC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAQpCO,OARoC,GAQnB,IARmB;AAAA,eAS5BC,cAT4B,GASH,CATG;AAAA;;AAWpCC,QAAAA,KAAK,GAAG;AACJ,eAAKF,OAAL,GAAe,KAAKG,IAAL,CAAUC,YAAV,CAAuBV,KAAvB,CAAf,CADI,CAEJ;;AAEA,gBAAMW,QAAQ,GAAGC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAjB;AACA,eAAKN,cAAL,GAAsBI,QAAQ,GAAGG,UAAU,CAACH,QAAD,CAAb,GAA0B,CAAxD,CALI,CAMJ;;AACA,eAAKI,WAAL,CAAiBC,MAAjB,GAA2B,SAAQ,KAAKT,cAAL,CAAoBU,OAApB,CAA4B,CAA5B,CAA+B,GAAlE;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,cAAI,KAAKC,MAAL,CAAYV,YAAZ;AAAA;AAAA,gCAAiCW,OAArC,EAA8C;AAC1C,kBAAMC,CAAC,GAAG,KAAKF,MAAL,CAAYG,QAAZ,CAAqBD,CAA/B;AACA,kBAAME,WAAW,GAAGC,IAAI,CAACC,GAAL,CAASJ,CAAT,IAAc,IAAd,GAAqB,CAArB,GAAyBA,CAA7C;AACA,iBAAKhB,OAAL,CAAaU,MAAb,GAAuB,GAAEQ,WAAW,CAACP,OAAZ,CAAoB,CAApB,CAAuB,GAAhD;AACA,iBAAKZ,QAAL,CAAcW,MAAd,GAAwB,SAAQQ,WAAW,CAACP,OAAZ,CAAoB,CAApB,CAAuB,GAAvD,CAJ0C,CAK1C;;AACA,gBAAIO,WAAW,GAAG,KAAKjB,cAAvB,EAAuC;AACnC,mBAAKA,cAAL,GAAsBiB,WAAtB;AACA,mBAAKT,WAAL,CAAiBC,MAAjB,GAA2B,SAAQ,KAAKT,cAAL,CAAoBU,OAApB,CAA4B,CAA5B,CAA+B,GAAlE;AACAL,cAAAA,YAAY,CAACe,OAAb,CAAqB,aAArB,EAAoC,KAAKpB,cAAL,CAAoBqB,QAApB,EAApC;AACH;AACJ;AACJ;;AAlCmC,O;;;;;iBAGrB,I;;;;;;;iBAEG,I;;;;;;;iBAEG,I","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\r\nimport { Player } from './Player';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Distance')\r\nexport class Distance extends Component {\r\n\r\n    @property(Node)\r\n    player: Node = null;\r\n    @property(Label)\r\n    Distance: Label = null;\r\n    @property(Label)\r\n    MaxDistance: Label = null;\r\n    content: Label = null;\r\n    private maxDistanceNum: number = 0;\r\n\r\n    start() {\r\n        this.content = this.node.getComponent(Label);\r\n        // 读取本地存储：如果有值就用之前的最高分，没有就默认0（不强制重置）\r\n\r\n        const savedMax = localStorage.getItem('maxDistance');\r\n        this.maxDistanceNum = savedMax ? parseFloat(savedMax) : 0;\r\n        // 初始化显示最高分（用读取到的真实值）\r\n        this.MaxDistance.string = `最高得分为:${this.maxDistanceNum.toFixed(1)}m`;\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this.player.getComponent(Player).enabled) {\r\n            const z = this.player.position.z;\r\n            const normalizedZ = Math.abs(z) < 0.05 ? 0 : z;\r\n            this.content.string = `${normalizedZ.toFixed(1)}m`;\r\n            this.Distance.string = `当前得分为:${normalizedZ.toFixed(1)}m`;\r\n            // 只有当前距离超过历史最高分，才更新\r\n            if (normalizedZ > this.maxDistanceNum) {\r\n                this.maxDistanceNum = normalizedZ;\r\n                this.MaxDistance.string = `最高得分为:${this.maxDistanceNum.toFixed(1)}m`;\r\n                localStorage.setItem('maxDistance', this.maxDistanceNum.toString());\r\n            }\r\n        }\r\n    }\r\n\r\n}"]}